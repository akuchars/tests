<databaseChangeLog
		xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

	<changeSet id="Initialize schema and database - 7" author="akuchars">
		<sql>
			create schema personal;

			create table personal.users
			(
				id bigserial not null,
				constraint personal_pk primary key (id)
			);

			create schema task;

			create table task.projects
			(
				id bigserial not null,
				name varchar,
				owner_id int not null,
				constraint project_pk primary key (id),
				constraint project_personal_fk foreign key (owner_id) references personal.users(id)
			);

			create table task.tasks
			(
				id bigserial not null,
				content varchar not null,
				title varchar not null,
				priority varchar not null,
				status varchar not null,
				creator_id int not null,
				assignee_id int not null,
				parent_id int not null,
				constraint task_pk primary key (id),
				constraint task_personal_creator_fk foreign key (creator_id) references personal.users(id),
				constraint task_personal_assignee_fk foreign key (assignee_id) references personal.users(id),
				constraint task_project_fk foreign key (parent_id) references task.projects(id)
			);
		</sql>
	</changeSet>

	<changeSet id="Adding missing column in tasks and projects tables - 7" author="akuchars">
		<sql>
			alter table task.tasks add column created_time date;
			alter table task.tasks add column update_time date;
			alter table task.projects add column created_time date;
			alter table task.projects add column update_time date;
		</sql>
	</changeSet>

	<changeSet id="Adding authentication to user data" author="">
		<sql>
			alter table personal.users add column name varchar not null;
			alter table personal.users add column surname varchar not null;
			alter table personal.users add column email varchar not null;
			alter table personal.users add column phone varchar;
			alter table personal.users add column password varchar;

			create table personal.roles
			(
				id bigserial not null,
				role varchar not null,
				constraint role_pk primary key (id),
				constraint role_unique unique (id)
			);

			create table personal.users_roles
			(
				user_id bigserial not null,
				role_id bigserial not null,
				constraint user_role_pk primary key (user_id, role_id)
			);

			insert into personal.roles values(1, 'ADMIN');
			insert into personal.roles values(2, 'USER');
		</sql>
	</changeSet>

	<changeSet id="Editing users table" author="akuchars">
		<sql>
			alter table personal.users add column enable boolean not null default true;
			alter table personal.users add constraint user_email_unique unique (email);
		</sql>
	</changeSet>

	<changeSet id="Adding users to project" author="akuchars">
		<sql>
			create table task.projects_users
			(
				user_id bigserial not null,
				project_id bigserial not null,
				constraint user_role_pk primary key (user_id, project_id)
			);
		</sql>
	</changeSet>

	<changeSet id="Adding time period task column" author="akuchars">
		<sql>
			alter table task.tasks add column start_time date;
			alter table task.tasks add column end_time date;
		</sql>
	</changeSet>
</databaseChangeLog>